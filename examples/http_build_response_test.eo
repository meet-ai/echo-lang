// HTTP build_response 函数测试
// 测试 build_response() 函数的功能

import http

func test_build_response_empty_headers() -> void {
    // 测试空headers的情况
    let resp: HttpResponse = HttpResponse {
        status_code: 200,
        status_text: "OK",
        headers: {},
        body: []
    }
    
    let response_data: []u8 = build_response(resp)
    
    // 验证响应数据不为空
    if len(response_data) == 0 {
        print "ERROR: build_response returned empty data for empty headers"
        return
    }
    
    print "PASS: build_response with empty headers"
}

func test_build_response_with_headers() -> void {
    // 测试带headers的情况
    let mut headers: map[string]string = {}
    headers["Content-Type"] = "application/json"
    headers["Content-Length"] = "42"
    
    let resp: HttpResponse = HttpResponse {
        status_code: 200,
        status_text: "OK",
        headers: headers,
        body: []
    }
    
    let response_data: []u8 = build_response(resp)
    
    // 验证响应数据不为空
    if len(response_data) == 0 {
        print "ERROR: build_response returned empty data for headers"
        return
    }
    
    print "PASS: build_response with headers"
}

func test_build_response_with_body() -> void {
    // 测试带正文的情况
    let mut headers: map[string]string = {}
    headers["Content-Type"] = "text/plain"
    
    let body: []u8 = [72, 101, 108, 108, 111]  // "Hello" in bytes
    
    let resp: HttpResponse = HttpResponse {
        status_code: 200,
        status_text: "OK",
        headers: headers,
        body: body
    }
    
    let response_data: []u8 = build_response(resp)
    
    // 验证响应数据不为空
    if len(response_data) == 0 {
        print "ERROR: build_response returned empty data for body"
        return
    }
    
    print "PASS: build_response with body"
}

func main() -> void {
    print "Testing HTTP build_response function..."
    
    test_build_response_empty_headers()
    test_build_response_with_headers()
    test_build_response_with_body()
    
    print "All tests completed"
}
