// async_test.eo - 异步功能测试

// 异步函数定义
async func fetchData(url: string) -> string {
    print "Fetching data from: " + url
    return "data from " + url
}

// Future类型函数 - 通过spawn返回Future
func processData() -> Future[string] {
    return spawn fetchData("http://api.example.com")
}

// await表达式测试
func testAwait() -> void {
    let future: Future[string] = spawn fetchData("http://test.com")
    let result: string = await future
    print "Result: " + result
}

// spawn表达式测试
func testSpawn() -> void {
    spawn fetchData("http://background.com")
    print "Spawned background task"
}

// 通道操作测试
func testChannels() -> void {
    let ch: chan string = chan string
    spawn sendMessage(ch)
    let msg: string = <- ch
    print "Received: " + msg
}

// 测试spawn参数传递
func testSpawnArgs() -> void {
    spawn fetchData("test url")
    print "Spawned with args"
}

func sendMessage(ch: chan string) -> void {
    ch <- "Hello from goroutine"
}

// 主函数
func main() -> void {
    testAwait()
    testSpawn()
    testChannels()
    testSpawnArgs()
    print "Async test completed"
}
