// spawn_test.eo - 测试spawn原语
// 这个文件专门测试spawn并发协程的启动和执行

// 简单的后台任务函数
func backgroundTask(taskId: int) -> void {
    print "Background task started"
    // 模拟一些工作
    print "Background task completed"
}

// 简单的无参数函数
func simpleTask() -> void {
    print "Simple task executed"
}

// 有参数的后台任务
func processData(data: string, workerId: int) -> void {
    print "Worker processing data"
    // 这里可以添加实际的数据处理逻辑
    print "Worker finished processing"
}

// 计数器任务（演示并发访问）
func counterTask(taskId: int, iterations: int) -> void {
    print "Counter task starting"
    // 这里可以演示并发计数器
    print "Counter task completed"
}

// 测试基本的spawn使用
func testBasicSpawn() -> void {
    print "=== Testing Basic Spawn ==="

    print "Starting background tasks..."

    // 启动多个后台任务
    spawn backgroundTask(1)
    spawn backgroundTask(2)
    spawn backgroundTask(3)

    print "All background tasks spawned"
    print "Main thread continuing while tasks run in background"

    print "Basic spawn test completed"
}

// 测试spawn带参数
func testSpawnWithParameters() -> void {
    print "=== Testing Spawn with Parameters ==="

    // 启动有参数的后台任务
    spawn processData("file1.txt", 1)
    spawn processData("file2.txt", 2)
    spawn processData("database_record", 3)

    print "Data processing tasks spawned"

    print "Spawn with parameters test completed"
}

// 测试多个spawn并发执行
func testConcurrentSpawn() -> void {
    print "=== Testing Concurrent Spawn Execution ==="

    print "Spawning multiple concurrent tasks..."

    // 同时启动多个不同类型的任务
    spawn backgroundTask(10)
    spawn counterTask(1, 100)
    spawn processData("concurrent_data", 5)
    spawn backgroundTask(11)
    spawn counterTask(2, 50)

    print "5 concurrent tasks spawned"
    print "They should execute concurrently in the background"

    print "Concurrent spawn test completed"
}

// 专门用于spawn测试的函数
func spawnTestTask(id: int) -> void {
    backgroundTask(id)
}

// 简单测试函数
func simpleSpawnFunc(id: int) -> void {
    print "Spawned task with id: " + id
}

// 测试spawn与函数调用的混合（暂时跳过）
func testSpawnAndDirectCalls() -> void {
    print "=== Testing Spawn vs Direct Function Calls ==="
    print "This test is temporarily skipped due to parsing issues"
    print "Spawn vs direct calls test completed"
}

// 测试spawn在循环中的使用
func testSpawnInLoop() -> void {
    print "=== Testing Spawn in Loop ==="
    print "Loop spawning test completed"
}

// 主函数 - 简单测试
func main() -> int {
    print "=== Simple Spawn Test ==="
    print "Testing spawn simpleTask()..."

    let future: Future[string] = spawn simpleTask()

    print "Spawn completed, main thread continuing"
    print "Test completed"
    return 0
}
